---
import admin from '@plugins/admin'
import { replaceWithFwdHost } from '@fixtures/url'
import { config as _config } from '@fixtures/config'
import { adminFactory } from '@devprotocol/clubs-core'

import PageNotFound from '@pages/404.astro'
import Layout from '@layouts/Landing.astro'
import Confirm_ from '@components/OnboardingPublish/Confirm.svelte'

const { site } = Astro.params
const clubsName = Astro.url.searchParams.get('clubsName') || ''
const tokenName = Astro.url.searchParams.get('tokenName') || ''
const tokenSymbol = Astro.url.searchParams.get('tokenSymbol') || ''

const { getStaticPaths, getCurrentConfig } = adminFactory({
  config: async () => await _config(site),
  plugins: [admin],
})

const config = await getCurrentConfig()
const path = (await getStaticPaths()).find(({ props }) => props.clubs)

const siteBaseUrl = ((url) => `${url.protocol}//${site}.${url.host}/`)(
  new URL(replaceWithFwdHost(Astro.request)),
)
---

{
  path ? (
    <Layout connectButton="show">
      <Confirm_
        client:only="svelte"
        clubsName={clubsName}
        tokenName={tokenName}
        tokenSymbol={tokenSymbol}
      />
    </Layout>
  ) : (
    <PageNotFound
      redirectionCtaText={`Take me to ${site?.toUpperCase()} homepage`}
      redirectionCtaUrl={siteBaseUrl}
    />
  )
}
